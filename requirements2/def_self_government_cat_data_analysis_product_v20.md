# [自治体猫データ分析プロダクト]のAWSアーキテクチャ設計書
## ゴール: 自治体猫データ分析プロダクトv20

## 1. 目的
本システムは、自治体が保有する猫に関するデータを収集・分析し、地域の猫の現状を把握し、適切な対策を立案することを目的としています。
AWSを使用することで、スケーラビリティ、可用性、セキュリティ、運用効率の高いシステムを構築することができます。

## 2. アーキテクチャ概要図
![](./assets/images/aws_architecture.png)

## 3. AWSサービスの選択
1. **Amazon S3**
   - 用途: 猫データの保管
   - 選択理由: 大量のデータを安全かつ低コストで保管できる
2. **Amazon Athena**
   - 用途: 猫データの分析
   - 選択理由: サーバーレスのSQL分析サービスで、迅速な分析が可能
3. **Amazon Glue**
   - 用途: ETLジョブの実行
   - 選択理由: データカタログの管理と、データの抽出・変換・読み込みを自動化できる
4. **Amazon QuickSight**
   - 用途: 分析結果の可視化
   - 選択理由: BI ツールとして、迅速なダッシュボード作成が可能
5. **Amazon API Gateway**
   - 用途: API管理
   - 選択理由: RESTful APIの作成、保護、モニタリングが容易
6. **AWS Lambda**
   - 用途: サーバーレスコンピューティング
   - 選択理由: イベント駆動型の処理を簡単に実装できる

## 4. 各AWSサービスの設定
1. **Amazon S3**
   - バケット名: `my-cat-data-bucket`
   - バージョニング: 有効化
   - 暗号化: AES-256
   - 設定理由: 大容量のデータを安全に保管するため
2. **Amazon Athena**
   - データカタログ: AWS Glueを使用
   - クエリ結果の出力先: Amazon S3
   - 設定理由: SQL分析を容易に行えるため
3. **Amazon Glue**
   - クロールスケジュール: 毎日実行
   - ETLジョブ: 週1回実行
   - 設定理由: データカタログの更新と、定期的なデータの変換・読み込みを行うため
4. **Amazon QuickSight**
   - データソース: Amazon Athena
   - ダッシュボード: 月次レポート、週次レポート
   - 設定理由: 分析結果を視覚的に表示するため
5. **Amazon API Gateway**
   - APIエンドポイント: `/cats`
   - 認証: IAM
   - 設定理由: 猫データにセキュアにアクセスできるようにするため
6. **AWS Lambda**
   - 関数名: `process-cat-data`
   - トリガー: Amazon S3のイベント
   - 設定理由: 新しいデータが追加されたときに自動的に処理を行うため

## 5. ネットワーク構成
- **VPCのCIDRブロック**: `10.0.0.0/16`
- **パブリックサブネット**: `10.0.1.0/24`, `10.0.2.0/24`
- **プライベートサブネット**: `10.0.10.0/24`, `10.0.20.0/24`
- **セキュリティグループ**:
  - インバウンド: HTTP(80), HTTPS(443)
  - アウトバウンド: すべてのトラフィックを許可
- **NACL**:
  - インバウンド: HTTP(80), HTTPS(443), 自治体からのアクセス(任意のポート)
  - アウトバウンド: すべてのトラフィックを許可

## 6. 可用性と耐障害性
- **マルチAZ構成**: 各AWSサービスをマルチAZで構成することで、可用性を確保する
- **オートスケーリング**: 需要に応じてリソースを自動的に拡張/縮小する
- **ロードバランシング**: Amazon API Gatewayを使用し、トラフィックを分散する

## 7. セキュリティ対策
- **IAMによるアクセス制御**: 最小特権の原則に基づいてユーザーやロールを管理
- **暗号化**: Amazon S3のサーバー側暗号化、AWS KMSを使用したデータ暗号化
- **WAF**: Amazon API Gatewayに統合し、一般的な攻撃パターンからの保護を行う

## 8. 運用・保守
- **CloudWatch**: メトリクスの収集、アラーミング、ログ管理を行う
- **CloudTrail**: APIコールのログ記録と監査を行う
- **AWS Config**: リソースの設定変更を記録し、コンプライアンスを確認する

本アーキテクチャは、AWSのベストプラクティスに基づいて設計されています。スケーラビリティ、可用性、セキュリティ、運用効率が高く、コスト最適化の観点からも適切なリソース選定を行っています。