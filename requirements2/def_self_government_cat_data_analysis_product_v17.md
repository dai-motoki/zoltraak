# システム名のAWSアーキテクチャ設計書
## ゴール: 自治体猫データ分析プロダクトv17

1. 目的
このシステムの目的は、自治体の猫に関するデータを収集、分析し、自治体の猫対策に役立てることです。AWSを使用することで、スケーラビリティ、可用性、セキュリティ、運用効率の高いシステムを構築できます。

2. アーキテクチャ概要図
```
+-------------------+
|     API Gateway  |
+-------------------+
         |
         |
+-------------------+
|     Lambda       |
+-------------------+
         |
         |
+-------------------+
|    DynamoDB      |
+-------------------+
         |
         |
+-------------------+
|     S3           |
+-------------------+
         |
         |
+-------------------+
|   Athena         |
+-------------------+
         |
         |
+-------------------+
|   QuickSight     |
+-------------------+
```

3. AWSサービスの選択
- **API Gateway**: 外部からのHTTP/HTTPS接続を受け付け、Lambdaへ転送する。
- **Lambda**: 非同期処理やデータ変換などのビジネスロジックを実行する。
- **DynamoDB**: 猫の情報などの構造化データを格納する。
- **S3**: 画像データや非構造化データを格納する。
- **Athena**: S3に格納された非構造化データを分析する。
- **QuickSight**: 分析結果を可視化する。

4. 各AWSサービスの設定
- **API Gateway**:
  - REST APIタイプ
  - 認証: API Keyを使用
  - メソッド: GET, POST, PUT, DELETE
  - 統合先: Lambda関数
- **Lambda**:
  - ランタイム: Python 3.9
  - メモリ: 512MB
  - タイムアウト: 10秒
  - 環境変数: DynamoDB, S3のアクセス情報
- **DynamoDB**:
  - パーティションキー: 自治体ID
  - ソートキー: 猫ID
  - 読み込み/書き込み容量: オンデマンド
- **S3**:
  - バケット名: my-cat-data
  - オブジェクトのアクセス権限: 非公開
- **Athena**:
  - データカタログ: Glueカタログ
  - クエリ結果出力先: S3
- **QuickSight**:
  - データソース: Athena
  - ダッシュボード: 自治体別の猫データ分析

5. ネットワーク構成
- **VPC**:
  - CIDR: 10.0.0.0/16
- **サブネット**:
  - パブリックサブネット: 10.0.1.0/24, 10.0.2.0/24
  - プライベートサブネット: 10.0.10.0/24, 10.0.11.0/24
- **セキュリティグループ**:
  - API Gateway: インバウンド - HTTPS(443)
  - Lambda: インバウンド - API Gateway, 
  - DynamoDB: 
  - S3: 
- **NACL**:
  - パブリックサブネット: インバウンド - HTTPS(443), outbound - ALL
  - プライベートサブネット: インバウンド - Lambda, DynamoDB, S3, outbound - ALL

6. 可用性と耐障害性
- マルチAZでDynamoDB, S3を構成し、可用性を確保する
- API Gateway, Lambda, Athenaはマネージドサービスのため、高可用性が確保される
- オートスケーリングを有効化し、需要変動に合わせてリソースを自動で調整する

7. セキュリティ対策
- IAMでサービスごとの最小権限を設定
- DynamoDB, S3のデータを暗号化
- WAFでAPIへのアクセスを制限
- CloudTrailでリソースの変更履歴を記録

8. 運用・保守
- CloudWatchでリソースの稼働状況を監視
- CloudTrailでリソースの変更履歴を記録
- AWS Configで設定の変更を検知
- コスト最適化のため、リザーブドインスタンスの活用、未使用リソースの削除を検討