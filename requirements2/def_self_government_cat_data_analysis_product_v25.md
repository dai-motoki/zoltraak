# [自治体猫データ分析プロダクトv24]のAWSアーキテクチャ設計書
## ゴール: 自治体猫データ分析プロダクトv24
自治体が保有する猫の情報を収集・分析し、自治体の施策に活用することを目的としたシステムです。AWSを活用することで、柔軟性、スケーラビリティ、高可用性を実現し、効率的な運用が可能となります。

## 1. 目的
本システムの目的は、自治体が保有する猫の情報を収集・分析し、自治体の施策立案に活用することです。AWSのクラウドサービスを活用することで、柔軟性、スケーラビリティ、高可用性を実現し、効率的な運用が可能となります。

## 2. ファイル・フォルダ構成
```
- frontend/
  - index.html
  - app.js
  - styles.css
- backend/
  - api/
    - controllers/
    - models/
    - routes/
  - utils/
  - app.js
- infra/
  - cloudformation/
    - vpc.yaml
    - ec2.yaml
    - rds.yaml
  - terraform/
    - main.tf
    - variables.tf
    - outputs.tf
- tests/
  - unit/
  - integration/
  - e2e/
- assets/
  - images/
    - aws_architecture.png
```

## 3. AWSアーキテクチャ概要図
![](./assets/images/aws_architecture.png)

## 4. AWSサービスの選択
以下のAWSサービスを使用します。

**Amazon EC2**
- 用途: Webアプリケーションのバックエンドサーバーとして使用
- 選択理由: 仮想サーバーを柔軟にスケーリングできるため

**Amazon RDS**
- 用途: 猫データの永続化
- 選択理由: 管理されたデータベースサービスを利用できるため

**Amazon S3**
- 用途: 猫の画像ファイルの格納
- 選択理由: 大容量のデータを高可用性で保管できるため

**Amazon CloudFront**
- 用途: Webアプリケーションのフロントエンドコンテンツの配信
- 選択理由: コンテンツをエッジロケーションから配信することで、ユーザーへの応答性を向上させられるため

**AWS Lambda**
- 用途: 非同期処理タスクの実行
- 選択理由: サーバーレスで柔軟にスケーリングできるため

**Amazon API Gateway**
- 用途: WebアプリケーションのバックエンドAPIの公開
- 選択理由: RESTfulなAPIを簡単に構築・管理できるため

**Amazon CloudWatch**
- 用途: システムの監視とログ管理
- 選択理由: AWSリソースの稼働状況を一元的に確認できるため

**AWS IAM**
- 用途: ユーザーアクセス管理
- 選択理由: 最小権限の原則に基づいたアクセス制御が可能なため

## 5. 各AWSサービスの設定
**Amazon EC2**
- インスタンスタイプ: t3.medium
- AMI: Amazon Linux 2
- セキュリティグループ: ポート22、80、443を許可
- 理由: Webアプリケーションのバックエンドサーバーとして適切なリソース構成

**Amazon RDS**
- エンジン: PostgreSQL 12
- インスタンスクラス: db.t3.medium
- マルチAZ: 有効
- 暗号化: 有効
- 理由: 猫データの永続化に適したデータベースサービス。高可用性と暗号化により、データの信頼性と安全性を確保

**Amazon S3**
- バケット名: cat-data-v24
- バージョニング: 有効
- 暗号化: サーバー側暗号化
- 理由: 猫の画像ファイルを大容量かつ高可用性で保管するのに適したストレージサービス

**Amazon CloudFront**
- オリジンドメイン: cat-data-v24.s3.amazonaws.com
- 最小TTL: 300秒
- 理由: Webアプリケーションのフロントエンドコンテンツを高速に配信し、ユーザーエクスペリエンスを向上させるため

**AWS Lambda**
- ランタイム: Node.js 14.x
- メモリサイズ: 512 MB
- タイムアウト: 10秒
- 理由: 非同期処理タスクを効率的に実行するためのサーバーレスコンピューティングサービス

**Amazon API Gateway**
- エンドポイントタイプ: Regional
- セキュリティ: IAMによるアクセス制御
- 理由: WebアプリケーションのバックエンドAPIを簡単に公開・管理できるため

## 6. ネットワーク構成
**VPC**
- CIDR ブロック: 10.0.0.0/16

**サブネット**
- パブリックサブネット: 10.0.1.0/24, 10.0.2.0/24
- プライベートサブネット: 10.0.10.0/24, 10.0.11.0/24

**セキュリティグループ**
- EC2インスタンス: ポート22、80、443を許可
- RDS: ポート5432を許可
- Lambda: 必要なポートを許可

**NACL**
- パブリックサブネット: ポート22、80、443を許可
- プライベートサブネット: ポート5432を許可

## 7. 可用性と耐障害性
- マルチAZでRDSを構成し、高可用性を確保
- Auto Scalingグループを使ってEC2インスタンスをスケーリング
- CloudFrontを使ってコンテンツを配信し、ユーザーへの応答性を向上
- Lambdaを使って非同期処理を実行し、スループットを確保

## 8. セキュリティ対策
- IAMを使ってユーザーアクセスを最小権限の原則に基づいて管理
- RDSとS3のデータを暗号化
- WAFを使ってWebアプリケーションへの不正アクセスを防御
- CloudTrailを使ってAWSリソースの変更履歴を記録

## 9. 運用・保守
- CloudWatchを使ってリソースの稼働状況を監視
- CloudTrailを使ってAWSリソースの変更履歴を記録
- AWS Configを使ってAWSリソースの設定状態を監視

以上のようなAWSアーキテクチャを構築することで、自治体猫データ分析プロダクトv24の目的を効率的に達成できると考えます。